---
title: 四维计算机图形学建模技术
tags:
  - 物理
  - 科幻
  - 几何
categories: 奇特世界系列
---
上篇文章说到了如何渲染四维几何体，但还没提到四维几何体的数据从何而来。首先我们先看看胞腔复形，上篇文章已经介绍过了，而作为这篇文章的重点基础知识，我们先来复习一下: 除了顶点需要单独描述坐标外，其它高维面我们均描述组成它的边的序号。比如一个点:
一条线段:
一个正方形:
一个四面体:
一个正方体:
对于四维图形也一样，只是再多了一行数据，比如一个正五胞体:

简单的图形是可以手写出来的，复杂图形就必须靠生成了，常见的生成算法有柱化锥化直积等等，我们先来看最简单的锥化。
## 对于一个平直的胞腔复形C，我们在它所在超平面外找一点作为锥点，


## 正多胞体生成算法
正多胞体的结构其实就是超球面上的密铺。
推荐pywonderland朝花夕拾。
### 定向胞腔复形
在渲染中，往往会将三角形按朝向相机的顶点顺序分成正面和反面从而实现背面消隐或给双面赋予不同材质。如何给一般的胞腔复形赋予定向呢？如果你有看过同调论中链群这节，应该就会有思路:所有的n维面都有两种可能的方向，比如顶点有“正”与“负”两种状态，线段有两种相反方向，面可以根据组成它的线段的方向也有两种方向，体(胞)的定向则由它的面的方向决定。具体怎样在计算机中记录呢？比如我们人为规定所有的顶点定向都为正，所有线段记录的两个端点中，第一个为正，第二个为负，所有多边形则可以规定沿边的指向顺序来书写，但对于三维胞的二维面则不存在任何有意义的顺序，不可能再利用顺序来确定定向，我们只能按从低维到高维按胞腔复形的构造方式来定义定向:某高维面的定向取决于它边界的定向。如果与默认的边界定向一致，则记作true，不一致则记作false，这样我们会得到一张全是布尔类型的定向表，比如一个定向了的三棱柱。
注意三棱柱只是确定了三维的定向，低维默认定向如何是无所谓的，下面分别展示了同样定向的三棱柱但更改了某些二维和一维默认定向。
有了表示定向的方法，如何在构建多胞体时同时更新定向信息呢，下面以锥化与直积为例看下怎样处理定向信息。
### 锥形
锥形的表面由底面与底面边缘锥化而来的侧面组成，将胞腔$A$的锥化记作$\widehat{A}$，设$\dim{A}=n$，引入表示定向的未知数$a$，选择与底面相容的定向，则有：$$\partial(\widehat{A}) = A + a(n) \widehat{\partial A}$$两边再取边缘算子，得到$$0=\partial A + a(n) (\partial A + a(n-1) \widehat{\partial \partial A} )$$最终得到$a(n)=-1$。
#### 直积形
我们知道直积形的表面有公式$\partial (A \times B) = \partial A \times B + A \times \partial B$，但这个公式完全没涉及定向，需要改造公式：加入表示定向的未知数$a $与$b$，它们均只能取$\pm 1$，且跟图形维度有关，设$\dim{A}=m$，$\dim{B}=n$，则这里的$a$、$b$其实是$m,n$的函数，即：$$\partial (A \times B) = a(m,n)\partial A \times B + b(m,n)A \times \partial B$$由于定向一定有两种选择，所以可以人为选择一个方向作为两个定向图形的直积形的定向的定义，这里我选择$b(m,n)=1$，即在直积后保持A图形的定向与原A图形定向一致，于是有：$$\partial (A \times B) = a(m,n)\partial A \times B + A \times \partial B$$边界一定封闭，即$$\partial^2 (A \times B) = 0 = a(m,n)\partial(\partial A \times B) + \partial(A \times \partial B)$$利用$\partial^2A=0$与$\partial^2B=0$，再注意$\dim(\partial A)=m-1$，$\dim(\partial B)=n-1$，可以化简得到：$$0 = a(m,n)(\partial A \times \partial B) + a(m,n-1)(\partial A \times \partial B)$$$A$与$B$可以是任意图形，因此要让等式恒成立就有$a(m,n)=-a(m,n-1)$，为了能让递推式能顺利进行，我们需要给出初值。当图形$B$为0维点时，我们希望它能像标量一样直接不改变图形A的定向，即$a(m,0) = 1$，这样我们就得到了$a(m,n)=(-1)^n$。
### 胞腔复形的单形剖分
我们在上期渲染中其实已经提到过将多面体分成四面体的算法了，但那个算法是有些小问题的。比如我们分别四面体化了两个六面体，如果它们的公共四边形的四点不共面且两边三角化方向不一致，则中间可能会出现一个中空的四面体结构，因此一个性质良好的剖分必须要在边界上保持一致，所以六面体网格应该采用下图左边的模式而不是右边那种。那给定一个任意的四维胞腔复形，怎样得到符合上述要求的最佳剖分呢？遗憾的是这个问题的算法是NPhard的，即没有多项式时间之内的算法，并且更可悲的是，有些凹多面体在不引入新顶点的情况下是不存在四面体剖分的，比如下面这种扭棱三棱柱，这说明给定低维胞腔的一种剖分不一定存在合法的高维剖分，比如三棱柱就只存在这几种合法剖分，而六面体则就更多了，总结下来有这些情况:注意这里面只有两种剖分产生了5个四面体，是最优的，其余方案则均产生6个四面体，在保证剖分合法的前提下，我们应该优先选择更少的剖分从而降低后续渲染的面数。

从这些例子大家可以窥见任意胞腔复形四面体剖分问题的困难程度。youtuber codeparade提出了一种只针对柱体适用的贪心算法来处理合法剖分的问题:若三维底胞是全由三角形构成的二维网格，则这些三角形将柱化成三棱柱，每条边柱化成了三棱柱侧面的矩形，每个矩形都有沿两条对角线三角化的方法，然而之前我们已经说到有些方案是不存在四面体剖分的，codeparade将对角线选择问题转化成了等价的图论中经典的双色染色问题，具体细节可以参考他的视频和这篇论文。