## 玩tesserxel:旋转动力学
### 随机旋转的角动量分布
### 网球效应
### 附录：刚体主轴求解

今天我们来聊一聊一个有趣的话题，四维空间中的一些常见的机械电器结构有哪些可能性？其实任何三维世界中的机器，哪怕是复杂的带电磁场的发电机都可以直接“柱化”得到相应的四维版的机器，但这样制造出来的东西可能并不是最优的。这篇文章主要就是想讨论柱化之外的、在四维空间中独有的机械设计的可能性。首先我们来看看瓶盖（螺栓也行）的结构该如何设计。我们假设四维人使用的矿泉水瓶近似为一个球柱形，则瓶盖部分也必须是一个球柱，我们要怎样安排其上的螺纹呢？之前在中说过，四维空间中的螺旋线、螺旋面并没有比三维空间丰富，至少我们用不了双旋转——它或许能作为五维人的瓶盖，我们

齿轮传动机构：
双旋转合成器
绝对垂直转换器

绝对垂直平面孔明锁

风力发电机、涡轮推进器
四维世界的飞行器、飞行器的矩阵



的通电螺线管会绕成什么结构？四维世界中的电磁铁、变压器、电机的可能结构是什么样子的？这是一个貌似很复杂的问题，但通过类比和利用四维空间的一些巧妙的性质我们会发现四维世界还有许多值得探究的东西。(螺栓、六轴飞行器)




## 二维/三维旋转
##### 二维旋转的描述
二维旋转，指定一个旋转角度$\theta$即可，并规定顺/逆时针对应角度的正负。注意千万不要强行引入垂直于二维平面的“旋转轴”，直接说它绕原点旋转即可。
我们可通过三角函数推导得到直角坐标系下把点$A=(x,y)$旋转$\theta$度到$A'=(x',y')$前后的坐标关系：
$$\begin{cases}x'=\cos(\theta)x-\sin(\theta)y \\\\ y'=\sin(\theta)x+\cos(\theta)y\end{cases} $$
这种变换关系是线性的，引入矩阵概念后（请参考任意的线性代数教材，本文默认读者熟悉它们）可写作：$$A'=\begin{pmatrix} cos(\theta) & -\sin(\theta) \\\\ sin(\theta) & \cos(\theta) \end{pmatrix} A$$
不同于给角度，矩阵显式地描述了旋转的坐标是如何变换的，因此它也是一种描述二维旋转的方法。除了矩阵还可以用单位复数表示旋转：将二维平面看成复平面，很容易验证乘以单位复数$z=\cos(\theta)+isin(\theta)$跟乘以上面的旋转矩阵是等价的。
##### 三维旋转的描述
描述三维旋转的方法非常多，最直观的方式是说“沿指定的轴a旋转了某个角度s”，其实描述清旋转的方向还有个坑，我们先忽略它，后面将从这个“坑”引入重要概念“旋量”。
另一种常见的三维旋转描述系统叫做“欧拉角”。它相当于描述了三次沿固定轴的旋转，复合起来得到整个旋转。注意用“欧拉角”时一定要指明三个轴的顺序，否则旋转结果会不同。欧拉角其实很符合人类对物体姿态朝向的认知：描述一架飞机，我们习惯先描述地图（俯视图）上的机头的指向，然后是俯仰角与横滚角。(做个飞机旋转的gif动画)直接要找到沿某个轴一次性到位的旋转对人类来说反而是更加困难的。
类似二维，三维旋转也可以使用旋转矩阵来计算旋转坐标。三维的“欧拉角”和“转轴+角度”表示法转换成矩阵都是一堆复杂的公式，这里就不列出来了，一般图形库里会提供这些现成的转换函数供程序猿使用。下面重点引入四元数——它是比矩阵更优雅的表示方式。
四元数是复数的推广，即引入“$i$”、“$j$”、“$k$”，其中$i^2=j^2=k^2=-1$，$ij=k$，$jk=i$，$ki=j$，注意它不满足交换律，因为有$ij=-ji$、$jk=-kj$、$ki=-ik$。这样定义四元数的乘法的原因后面会讲到。四元数$q$由四个部分组成：$q=a+bi+cj+dk$，其中$a$是实部，$bi+cj+dk$是虚部。三维旋转用一个单位四元数$R$表示，三维空间中的点则用纯虚数$p=xi+yj+zk$表示，旋转作用于点p的新坐标为$RpR^*$，其中$R^*$叫$R$的共轭，即像复共轭那样把虚部取反。
## 旋量与四元数
看到这里你可能会有点懵，四元数这个东西感觉不知道它在说啥，别慌，下面解释四元数的本质。这需要引入一个新的代数系统——几何代数。
#### 楔积与外代数
我们知道向量有内积和外积，内积很好推广到高维空间——简单把对应分量相乘再全加起来即可，外积就很麻烦了，它定义的是垂直于两向量所在平面的方向，大小是两向量张成平行四边形的面积，到了四维及以上，平面的法向量不唯一，导致垂直方向无法唯一确定。我们不妨在其它叉乘计算规则都不变的情况下，引入一种二维的向量直接表示平面作为“方向”，为了跟传统的叉乘“$\times$”区别，数学中一般用楔形符号“$\wedge$”表示，并叫它“楔积”。用$e_1$、$e_2$等表示单位坐标轴向量，则把叉乘的计算规则搬过来有$e_i\wedge e_i=0$、$e_i\wedge e_j=-e_j\wedge e_j$ $(i\neq j)$。在三维空间中如果把平面与它的法线等同，则“楔积”就可以跟“外积”等同：$e_x\wedge e_y$相当于$e_x\times e_y=e_z$，$e_y\wedge e_z$相当于$e_y\times e_z=e_x$，$e_z\wedge e_x$相当于$e_z\times e_x=e_y$。当然，到了四维就没有唯一的法线让我们等效外积了。
二维的向量到底是什么呢？在二维空间，它们像个标量，因为整个二维空间的平面只有一个方向，所有的二维向量都只能是$k e_x\wedge e_y$这样的形式；三维空间它又像个向量，即$a e_x\wedge e_y + b e_y\wedge e_z + c e_z\wedge e_x$；到了四维空间它才展现出自己的特点：根据坐标的两两组合，它有着六个分量：$a e_x\wedge e_y + b e_x\wedge e_z + c e_x\wedge e_w + d e_y\wedge e_z + e e_y\wedge e_w+ f e_z\wedge e_w$。
这篇旧文详细讲述了如何使用二维向量来计算平面之间的夹角等四维几何问题。
#### 几何代数
我们更进一步，将向量的内积与外积（其实是楔积）强行统一到一种代数系统里面来，就得到了几何代数。定义两个向量，如果垂直，则它们的几何积就是楔积得到的二维向量，若它们共线，则它们的几何积就是内积得到的标量，若它们既不垂直也不平行，则需先正交分解，然后再加起来，得到了一种标量与二维向量混合起来的奇怪东西。我们来看几个例子：计算向量$a=(1,2)$与$b=(2,3)$的几何积$ab$：我们将坐标按基向量写开：$a=e_x + 2 e_y$，$b=2e_x + 3 e_y$，则$ab = (e_x + 2 e_y)(2e_x + 3 e_y)$，用乘法分配率乘进去得到$ab=2e_xe_x+3e_x e_y+4e_y e_x + 6 e_y e_y$。根据定义，$e_xe_x=1$，$e_ye_y=1$，$e_x e_y=-e_y e_x$，因此最终化简得到$ab = 8-e_x e_y$。
这个东西有什么用呢？下面看它的第一个用处：表示反射。



### 三维旋转的储存方式

### 四元数是四维计算机图形学的“生产力”

四维空间中旋转描述可采用与三维类似的两种方法:1.指定一个旋转平面作为“轴”，再指定旋转角度。然而四维空间中有独特的双旋转现象，不清楚的看这里。由于双旋转一定可分解为两个绝对垂直的单旋转的合成，所以描述方式需要调整:指定一个旋转平面作为“轴”，再指定两个旋转角度，其中第一个角度描述绕该轴的旋转量，另一个角度描述绝对垂直的旋转的角度。2: 欧拉角的四维推广，我在四维飞行器设计中有大致提到这种表示方法。可以验证四维旋转有6个自由度。
## 分块矩阵合成旋转
虽然现在清楚了描述四维旋转的大致思路，但我们还没有能力去“使用”它们，比如，给定一个旋转，如何计算物体旋转前后的坐标变换关系呢？通常我们将坐标变换写成矩阵的形式。若读者不清楚矩阵的概念建议先找本线性代数的参考书熟悉相关概念后再继续往下看。二维旋转对应的矩阵很简单，展开这里给一些提示:
其实旋转角度是极坐标下描述旋转的方式: 给定P点的极坐标(r,theta)，它旋转alpha度就是单纯把极角加上alpha，原点距离r不变。根据直角坐标与极坐标的转换，可以化简得到直角坐标下的旋转变换公式，即旋转矩阵。
如何计算三维旋转矩阵呢？欧拉角表示法其实很方便:由于每次都旋转轴都平行于坐标轴，我们可以直接忽略转轴上的坐标，把剩余坐标当成二维旋转来处理，分别写出三次旋转的矩阵后，将矩阵按次许相乘即得到复合后的整个旋转。但对于不平行于坐标轴的旋转目前暂时还没有办法解决。
下面来到了四维: 把坐标轴两两组合成6对，逐一描述其旋转角度，由于旋转发生在坐标面上，我们可直接分别写出六个旋转矩阵，把它们按顺序相乘即可复合。然而对于不平行于坐标面的“斜着的”旋转我们目前还没工具解决。
## 旋转轴与旋转平面
下面总结一下各维度旋转规律:首先一维空间中物体是无法旋转的，二维空间旋转只有一个自由度，整个平面都在旋转;而三维空间与其说绕轴在旋转，还不如说旋转在垂直于轴的平面中进行; 从三维到四维与其说旋转线轴升维成了旋转面轴，还不如说旋转依然发生在两个维度上，只是由于维数升高使得不参与旋转的方向变多了，看到这里我们似乎能感觉到旋转是个二维的东西，(专业术语是:旋转的生成元是[2-向量]，稍后解释) 因此我们将放弃“旋转轴”这一概念，取而代之的是与之垂直的旋转平面，这样就能得到所有维度下一致的旋转描述。
如何描述旋转平面呢？线性代数告诉我们，只要两个向量不共线就能唯一确定一个二维平面空间。然而这种表示平面的方式太不唯一了，且不方便后续计算旋转。我们可以反其道而行--用旋转的某些性质来表示平面，这样不用特殊讨论双旋转情况也能将其囊括！
## 旋转生成元
我们说把物体向北移动5m和将图形顺时针旋转30度都只叙述了运动始末的位置变化，然而现实的运动都是连续的过程。引入瞬时速度可以刻画某个时刻运动的趋势: 取一个很小时间短上的平均速度来近似瞬时速度，时间越短就越精确。物体平移时，各点速度大小方向都相同，而旋转比平移困难在于物体上各个点的速度方向大小都有所不同，下面我们来研究一下旋转物体上的速度分布。对于二维旋转，速度方向是旋转轨迹圆的切线方向，它垂直于半径，且速度大小正比于到圆心的距离。根据三角形相似不难得到二维旋转速度分布的公式:。速度累积起来就是位移，因此可将无穷次“无穷小旋转”累乘起来得到旋转矩阵:跟这里我们通过极坐标转换得到的是一致的。
其实我们也可以对旋转矩阵求导来得到速度矩阵，详情点此展开。
对于三维旋转，给定一个向量v作为轴，如果找到了它的生成元矩阵，我们就能求出对应的旋转矩阵。根据旋转的几何性质不难知道，空间中任意一点x处的旋转速度方向同时垂直于轴和它向轴做的垂线。线性代数告诉我们可以用向量叉乘来计算，一番折腾下来得到这样的矩阵表达式。
下面我们来
现在对于四维及以上，我们可以先猜测无穷小旋转都是这样的反对称矩阵，通过指数映射可以证明它们确实都能生成旋转矩阵，详情展开这里。
## 外代数
现在虽然我们可以从无穷小旋转出发计算旋转矩阵了，但如何在四维中计算给定平面上的无穷小旋转呢？答案是这个公式。可以验证一下:
最后计算机储存的时候其实不需要存下整个矩阵，由于矩阵都是反对称的，因此可仅存储对角线上半部分的数字，更进一步，因为会计算很多重复数字，我们也不用老实做矩阵乘法，而将这些反对称矩阵看做一种新的代数系统--“外代数”，规定新的运算法则。
内积外积
下面我们总结一些常用的结论:
1. 平行，垂直判定 2. 夹角求解 3. 体积计算 4. 手性计算
## 几何代数与旋量
四维旋转矩阵一共有16个数，然而真正的自由度才只有6个。虽然通过外代数实现了无穷小旋转加角度来表示四维旋转，但要处理两个旋转的复合现在只能转换成矩阵再相乘。有没有更好的完全摆脱矩阵的代数系统呢？有！它是外代数的升级版--几何代数。我之前写过介绍几何代数的文章。为了更有整体性这里就再赘述一下。



给定一个旋转轴



除了矩阵，**单位复数**也能表示二维旋转，请点此展开详细介绍。复数相乘可以模拟缩放与旋转(推荐看看《维度数学漫步》): 乘以辐角为theta的单位复数相当于逆时针旋转theta度。本文默认读者熟知高中复数知识，这里着重说一下复数中那个著名的欧拉公式背后的深层含义，它涉及一个重要的新概念:无穷小旋转(或叫旋转的生成元)。
我们说把物体向北移动5m和将图形顺时针旋转30度都只比较了移动和旋转前后的位置差异，现实中运动是连续的过程。引入线速度与角速度可以刻画某个时刻物体平移或旋转的趋势: 我们取一个很小时间区间上的平均速度来近似瞬时速度，当时间趋于0时就得到了精确的瞬时速度。
用复数描述连续的旋转很简单，引入时间参数t即可，比如这个复数r(t)表示以1rad/s匀速旋转:r(t)=cos()+isin()。为了捕获“速度”的概念，我们可以选定一点p，看它旋转时的速度，即计算r(t)p对时间的导数，观察发现，由于p点不含时，整个旋转的角速度都有r'(t)刻画。但由于点p一直在旋转，它的速度方向是持续变化的，不方便研究角速度，我们不该持续跟踪一个动点，而该像在水流中固定浮标监测此处流速那样固定一个定点。该如何计算呢？r'(t)p代表t时刻点r(t)p处的速度，而t时刻的p点的初始位置在r(-t)p处，因此r'(t)r(-t)p才是我们要找的速度。计算可知r'(t)r(-t)是一个不含时间的纯虚数。为什么是纯虚数呢？因为旋转的轨迹是圆，速度是沿圆周切线方向，它垂直于半径方向，即速度由位置旋转90度再加一个比例缩放而来，这正是乘以一个纯虚数的几何意义。我们再来看看这个方程，它可以写作，指数函数是它的解。
给定角速度，我们也能够通过无数次无穷小旋转来逼近真实的旋转:

我们看到，这跟常数e的定义式是一致的。

类似复数，旋转矩阵也可以写成无穷小旋转来生成，由于跟复数分析类似，我们就直接写出结论:我们不难发现级数是微分方程的解。。

三维旋转
三维空间中的所有旋转
矩阵，欧拉角(实为矩阵分解表示)
平行于坐标轴的旋转(矩阵指数映射)
不平行于坐标轴的旋转
引入垂直霍奇对偶的概念
旋量登场(通过旋量引入四元数)



注意不同于线速度，旋转物体每个地方的速度方向是不同的，因此要精确描述旋转的速度，需要用一个矩阵:

其实复数跟矩阵表示旋转是等价的，复数乘以a+bi相当于矩阵乘以。复数的欧拉公式也能写成矩阵。

流动与星球自传
角度会随维度变化而连续变

记作R_theta，一般规定theta小于0为逆时针，大于0为顺时针。这其实是极坐标下描述旋转的方式: 给定P点的坐标(r,theta)，它旋转alpha度就是单纯把极角加上alpha，原点距离r不变。即R_alpha(P(r,theta))的坐标为(r,theta+alpha)。
然而计算机绘图时都用的直角坐标系，要用上面的公式就要把直角坐标转换成极坐标，旋转完后再转换回来，导致整个公式涉及到很多三角函数、反三角函数和开方。利用三角函数的和差角公式可以化简直接在直角坐标系里完成旋转，具体步骤参见这里。推导结果为:
R_alpha(p(x,y))=p'(sin(x))
这个公式有点长，后面我们还会遇到许多形如x'=a11x+a12y, y'=a21x+a22y
的坐标变换，我们记作，那个2x2的数阵就叫矩阵，我们这里定义了矩阵乘以向量坐标得到了新的向量坐标。注意矩阵乘法没有交换律，不能写成。我们后面将大量使用矩阵处理旋转，若对矩阵不熟悉建议找本线性代数的参考书。
有了矩阵，我们就可以把矩阵看做是旋转变换在直角坐标系下的“坐标”，它不同于点的坐标用两个数表示，旋转变换的坐
